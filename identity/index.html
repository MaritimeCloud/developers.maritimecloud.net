<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>MCP Identity Platform</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>MCP Identity Platform</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#a-bit-of-history">1.1. A Bit of History</a></li>
<li><a href="#overview">1.2. Overview</a></li>
<li><a href="#signing-up">1.3. Signing up</a></li>
<li><a href="#feedback">1.4. Feedback</a></li>
</ul>
</li>
<li><a href="#identity-management">2. Identity Management</a>
<ul class="sectlevel2">
<li><a href="#the-identity-registry">2.1. The Identity Registry</a></li>
<li><a href="#key-actor-concepts">2.2. Key Actor Concepts</a></li>
</ul>
</li>
<li><a href="#authentication">3. Authentication</a>
<ul class="sectlevel2">
<li><a href="#overview-2">3.1. Overview</a></li>
</ul>
</li>
<li><a href="#brokered-user-federation">4. Brokered User Federation</a>
<ul class="sectlevel2">
<li><a href="#openid-connect">4.1. OpenID Connect</a></li>
<li><a href="#mcp-user-federation-setup">4.2. MCP User Federation Setup</a></li>
<li><a href="#openid-connect-authentication-flow">4.3. OpenID Connect Authentication Flow</a></li>
<li><a href="#keycloack">4.4. Keycloack</a></li>
<li><a href="#getting-connected-to-mcp">4.5. Getting connected to MCP</a></li>
</ul>
</li>
<li><a href="#pki-and-x-509-certificates">5. PKI and X.509 Certificates</a>
<ul class="sectlevel2">
<li><a href="#get-mcp-root-certificate">5.1. Get MCP Root Certificate</a></li>
<li><a href="#certificate-attributes">5.2. Certificate Attributes</a></li>
<li><a href="#revocation-of-certificates">5.3. Revocation of certificates</a></li>
<li><a href="#certificate-authentication-flow">5.4. Certificate Authentication Flow</a></li>
<li><a href="#obtaining-a-openid-connect-token-using-a-certificate">5.5. Obtaining a OpenId Connect Token using a Certificate</a></li>
</ul>
</li>
<li><a href="#authorization">6. Authorization</a>
<ul class="sectlevel2">
<li><a href="#example-of-authorization">6.1. Example of Authorization</a></li>
</ul>
</li>
<li><a href="#terminology">7. Terminology</a></li>
<li><a href="#appendix">8. Appendix</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This development guide on the Maritime Connectivity Platform identity platform describes the current state of the MCP reference implementation.</p>
</div>
<div class="paragraph">
<p>Please do not email us directly about usage questions. Instead use our Google Group at <a href="https://groups.google.com/forum/#!forum/maritimeconnectivity" class="bare">https://groups.google.com/forum/#!forum/maritimeconnectivity</a> for general usage questions. In this way future users can see answers to commonly asked questions. Google Groups is also where we post information about new releases and updated documentation.</p>
</div>
<div class="paragraph">
<p>This developer guide is intended to make you familiar with developing secure applications and services for MCP in particular with regards to Identity Management.</p>
</div>
<div class="sect2">
<h3 id="a-bit-of-history"><a class="anchor" href="#a-bit-of-history"></a><a class="link" href="#a-bit-of-history">1.1. A Bit of History</a></h3>
<div class="paragraph">
<p>The Maritime Connectivity Platform project started out as an internal project at the Danish Maritime Authority in the autumn of 2012.
As part of the e-Navigation process the Danish Maritime Authority had been working on an e-Navigation Prototype Display system called EPD. The EPD consist of two applications for demonstrating potential e-navigation solutions. An ECDIS like ship side application and a shore side application.</p>
</div>
<div class="paragraph">
<p>During the development it was clear that AIS was a severe limiting factor when communicating between the ship side and the shore side. Putting a lot of limitations of the different kind of maritime services that could be developed. Especially three issues was identified.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lack of bandwidth.</strong> Only limited amounts of data could be transfered. Often using complex encoding schemes such as application specific AIS messages.</p>
</li>
<li>
<p><strong>Ease of development.</strong> There was no easy way to simulate AIS communication without a very complex developer environment.</p>
</li>
<li>
<p><strong>Limited Signal Coverage.</strong> There are certain types of services where the actors communicating might not all be within reach of radio signals.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first prototype was built in the winter of 2012 and was implemented in the EPD in spring 2013. It just featured basic point to point communication. This is basically what is the Maritime Message Service now. During the summer of 2013 the vision for a general framework for maritime communication was created. Including registries for services and identities in addition to the message based framework. It also got its name the “Maritime Connectivity Platform” as a sort of umbrella name for the various underlying services. In 2014 the first release of the MCP reference implementation was made available for the public.</p>
</div>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a><a class="link" href="#overview">1.2. Overview</a></h3>
<div class="paragraph">
<p>Here is a 10000 foot overview of MCP:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/contentimage_TheMaritimeCloud_orange_no_img.png" alt="Overview">
</div>
</div>
<div class="paragraph">
<p>There are 3 different core services provided by MCP</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Maritime Identity Registry.</strong> A centralized authority for identities of persons, organizations or ships that are using the MCP.</p>
</li>
<li>
<p><strong>Maritime Service Registry.</strong> A centralized repository of service standards and provisioned services world wide.</p>
</li>
<li>
<p><strong>Maritime Messaging Service (MMS).</strong> A communication protocol on top of TCP/IP. Supporting reliable delivery of messages and geocasting<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide will predominantly discuss the identity registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="signing-up"><a class="anchor" href="#signing-up"></a><a class="link" href="#signing-up">1.3. Signing up</a></h3>
<div class="paragraph">
<p>In order to get an organization, its users and any ships the organization might own on to the MCP, the organization needs to perform a signup process. The process is currently manual. To start the process, please fill out the <a href="https://management.maritimecloud.net/#/apply">registration form</a>.</p>
</div>
<div class="paragraph">
<p>Once your organization has been approved you will have access to MCP and its services. You should probably start by looking at the <a href="https://management.maritimecloud.net/">Management Portal</a>. See the <a href="http://manual.maritimeconnectivity.net/">manual</a> for how to use it.</p>
</div>
</div>
<div class="sect2">
<h3 id="feedback"><a class="anchor" href="#feedback"></a><a class="link" href="#feedback">1.4. Feedback</a></h3>
<div class="paragraph">
<p>Readers may send feedback about errors, omissions, and ambiguities in this guide to <a href="mailto:oliver@dmc.international">oliver@dmc.international</a> or even better submit a pull request to the documentation available at <a href="https://github.com/MaritimeConnectivityPlatform/developers.maritimeconnectivity.net" class="bare">https://github.com/MaritimeConnectivityPlatform/developers.maritimeconnectivity.net</a>.</p>
</div>
<div class="paragraph">
<p>As previously mentioned questions about usage of MCP should be directed to our Google Group at <a href="https://groups.google.com/forum/#!forum/maritimeconnectivity" class="bare">https://groups.google.com/forum/#!forum/maritimeconnectivity</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="identity-management"><a class="anchor" href="#identity-management"></a><a class="link" href="#identity-management">2. Identity Management</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Identity management refers to the process of employing technologies
to manage information about the identity of users and control access to company
resources. The goal of identity management is to improve productivity and
security while lowering costs associated with managing users and their identities,
attributes, and credentials.</p>
</div>
<div class="paragraph">
<p>The goal of the MCP Identity Registry is to create a solution that satisfies the most common identification needs for the entire maritime industry on a global scale.</p>
</div>
<div class="paragraph">
<p>This is not a simple task as any solution must support every possible user scenarios from small leisure sailors to multinational companies. The complexity of this task is why the functionality will be delivered over multiple milestones in the coming years. The most important things such as support for authentication will be implemented first. Additional functionality will be added based on user needs in the projects supported by MCP.</p>
</div>
<div class="sect2">
<h3 id="the-identity-registry"><a class="anchor" href="#the-identity-registry"></a><a class="link" href="#the-identity-registry">2.1. The Identity Registry</a></h3>
<div class="paragraph">
<p>In most of the documents that describe MCP there is the concept of an Identity Registry. In reality there are numerous systems both internal to MCP as well as external to MCP that makes up the identity registry. The main components of the Identity Registry are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Identity Registry API</p>
</li>
<li>
<p>The Identity Broker</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Identity Registry API provides management of entities in MCP and will be described later in this document.</p>
</div>
<div class="paragraph">
<p>The Identity Broker provides links to trusted Identity Providers, owned by maritime organizations that wish to connect its users to MCP. Within the scope of the EfficienSea 2 and STM validation projects, a special Identity Provider is available where organizations can create users without linking their own Identity Provider.</p>
</div>
<div class="paragraph">
<p>This will enable the participants in the projects to register actors to validate specific service concepts in testbed trials or utilize the operational services established by the projects, as well as validate the identity management concept of MCP. Beyond the scope of the project, it is foreseen that several identity registers will collaborate to form the global federated MCP Identity Registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="key-actor-concepts"><a class="anchor" href="#key-actor-concepts"></a><a class="link" href="#key-actor-concepts">2.2. Key Actor Concepts</a></h3>
<div class="paragraph">
<p>In order to be able to describe some of the concepts we are working with, here is a short introduction of the various actors we envision will interact with the identity registry.</p>
</div>
<div class="paragraph">
<p>Identity management and security is a very complex and comprehensive field. So wherever possible we must limit non-essential functionality. So clearly, there are some maritime entities that should not be a part of the identity registry. Therefore, the Identity Registry should not be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing information about entities that does not need to have access rights. For example, route or container information. While information about routes can be accessed by various users and systems. Routes by them self does not need access rights to access other information. It is only users and systems/devices that need access right.</p>
</li>
<li>
<p>Maintaining information about entities that are not security related. For example, business addresses of users and organizations. Or location information about entities that can be used, for example, for routing messages to the right location.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main reason for excluding all but non-essential security related information is that it opens up the never ending discussion about what exactly should be maintained in the identity registry. If we make a generalized information store that maintains and provides query capabilities for all kinds of information about users and systems/devices. For example, business addresses, geographical location. We might as well use this functionality for storing other queryable information. For example, maintaining information about routes or cargo.</p>
</div>
<div class="paragraph">
<p>This does not prohibit a later revisiting of these goals. Or prohibit including work from other groups into a general framework at a later time. But for time being the identity registry will revolve about the 5 entities listed below.</p>
</div>
<div class="sect3">
<h4 id="organization"><a class="anchor" href="#organization"></a><a class="link" href="#organization">2.2.1. Organization</a></h4>
<div class="paragraph">
<p>In MCP an organization is an entity, such as an institution, company or an association, that has a collective goal and is linked to an external environment. Examples, include international organizations such as IMO, IALA, IHO. National authorities such as US Coastguard, Swedish Maritime Administration. Local authorities such as VTS-Oeresund, Port of Rotterdam, Hong Kong SAR. Or commercial companies such as Transas or Maris.</p>
</div>
<div class="paragraph">
<p>In order to be able to use the functions of MCP in any way, an organization needs to be signed up to MCP. In the context of the EfficienSea 2.0 and STM projects, this is currently done be sending an email with various information about the organization to a MCP test bed administrator.</p>
</div>
<div class="paragraph">
<p>In the future a more automated process involving a validation workflow by some organization may validate the relationship between an organization in the real world, and the issued maritime digital identity. How this validation is to take place is still up for discussion. However, one possible solution would be for the maritime authorities in which a given organization is registered to put the stamp of approval on the signup application.</p>
</div>
<div class="paragraph">
<p>Once an organization has been registered (and validated), an identity administrator of that organization will be able to create and manage maritime identities that belong to this organization, such as Users, Vessels Devices or Services. This administration is typically done via MCP Portal which is a web based client. For some larger organizations it might make sense to integrate directly via the underlying APIs.</p>
</div>
<div class="paragraph">
<p>All organizations that are registered in MCP must be registered with a unique MRN.</p>
</div>
<div class="paragraph">
<p>The MRN is used in numerous places. For example, all service specifications from a given organization includes the organizations MRN.</p>
</div>
<div class="paragraph">
<p>Examples of valid organization ids:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>urn:mrn:mcl:org:imo</p>
</li>
<li>
<p>urn:mrn:mcl:org:iala</p>
</li>
<li>
<p>urn:mrn:mcl:org:dma</p>
</li>
<li>
<p>urn:mrn:mcl:org:portofrotterdam</p>
</li>
<li>
<p>urn:mrn:mcl:org:vts-oeresund</p>
</li>
<li>
<p>urn:mrn:mcl:org:amsa@iala</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MRN has been approved by <a href="https://www.iana.org/">IANA</a> as an official URN namespace. For more information on the MRN specification you can read more at <a href="https://www.iana.org/assignments/urn-formal/mrn" class="bare">https://www.iana.org/assignments/urn-formal/mrn</a></p>
</div>
</div>
<div class="sect3">
<h4 id="vessels"><a class="anchor" href="#vessels"></a><a class="link" href="#vessels">2.2.2. Vessels</a></h4>
<div class="paragraph">
<p>Vessels describe any floating object used for the carriage of people or goods.</p>
</div>
<div class="paragraph">
<p>The main need for registering vessels in MCP is so that digital authentication certificates can be issued for them. Thereby enabling secure communication between vessels as well as digitally signing of documents. Users might also use these authentication certificates for other purposes. The important thing is that the functionality is there.</p>
</div>
<div class="paragraph">
<p>As part of the authentication certificate of a vessel its name, MMSI number, IMO number, callsign and possible other attributes are included in the header of the authentication certificate.</p>
</div>
</div>
<div class="sect3">
<h4 id="services"><a class="anchor" href="#services"></a><a class="link" href="#services">2.2.3. Services</a></h4>
<div class="paragraph">
<p>Services refer to digital services. For example, a weather service that is available to other services for machine to machine communication. Services need to be registered in such a way that it can successfully authenticate users.</p>
</div>
</div>
<div class="sect3">
<h4 id="users"><a class="anchor" href="#users"></a><a class="link" href="#users">2.2.4. Users</a></h4>
<div class="paragraph">
<p>Users mainly refer to human users. Human users differ from other actors in that they typically use a username/password to login which implies a different interaction pattern with the identity registry than say communication between vessels.</p>
</div>
</div>
<div class="sect3">
<h4 id="devices"><a class="anchor" href="#devices"></a><a class="link" href="#devices">2.2.5. Devices</a></h4>
<div class="paragraph">
<p>Devices can be any number of entities that are not covered by the other entity types. It could for example be a lighthouse, an ECDIS or a server that needs to be able to authenticate itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="mms"><a class="anchor" href="#mms"></a><a class="link" href="#mms">2.2.6. MMS</a></h4>
<div class="paragraph">
<p>Maritime Messaging Service (MMS) is defined as an entity and a MCP-specific connectivity component hosted by an organization.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication"><a class="anchor" href="#authentication"></a><a class="link" href="#authentication">3. Authentication</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication is any process by which a system verifies the identity of a user (human or machine) who wishes to access it. Since access control is normally based on the identity of the user who requests access to a resource, authentication is essential to efficient security. In contrast to identification which refers to the act of stating a person or thing&#8217;s identity, authentication is the process of actually confirming the stated identity. It might involve verifying the authenticity of a website by a digital certificate that it provides, or validating a persons identity documents.</p>
</div>
<div class="sect2">
<h3 id="overview-2"><a class="anchor" href="#overview-2"></a><a class="link" href="#overview-2">3.1. Overview</a></h3>
<div class="paragraph">
<p>The way in which a human user or machine may be authenticated typically falls into three different categories, based on what is commonly known as the factors of authentication: something the user knows, something the user has, and something the user is. Each authentication factor covers a range of elements used to authenticate or verify a person&#8217;s identity prior to being granted access, approving a transaction request, signing a document or other work product, granting authority to others, and establishing a chain of authority.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Knowledge factors: Passwords, passphrases, pins, challenge response,</p>
</li>
<li>
<p>Ownership factors: ID card, Cell phone, authentication certificates,</p>
</li>
<li>
<p>Inheritance factors: Fingerprint, retinal patterns, face, voice,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Currently the implementation effort in MCP is concentrating on passwords for human users and authentication certificates for machine users. In the future we will probably add more methods.</p>
</div>
<div class="paragraph">
<p>While the difference of using authentication certificates or passwords might seem minor from a user perspective the underlying implementation and usage is radically different which is why it has been split into different sections.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="brokered-user-federation"><a class="anchor" href="#brokered-user-federation"></a><a class="link" href="#brokered-user-federation">4. Brokered User Federation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous section we discussed digital certificates for use in machine to machine communication. There are no technical reasons to why human users should not be able to use digital certificates to authenticate themselves as well. However, there are some serious practical issues that make it difficult to see them as a general solution for human user authentication. The first issue being that it requires that the certificate must always be present on the computer or mobile phone from which access is made. This is normally not a problem for machine to machine communication. Because, once installed the hardware configuration almost never changes. Unlike human users that use their computer during the day to access information, their mobile phone on the way back from work and their tablet in the evening from home. Making sure that certificates are installed on all these devices and refreshing them once they expire is a lot of effort to require from users. We believe having such a complicated setup would be a major barrier towards successful adoption of MCP. So for now, authentication of human users in MCP will be based on login through a web browser, using brokered federation.</p>
</div>
<div class="paragraph">
<p>Federation is the means of linking distinct identity management systems to a person&#8217;s electronic identity and attributes. For example, a shipping company might expose all their users in LDAP or Active Directory to MCP in such a way as they appear as MCP users. Thereby bypassing the need to manage their users directly in MCP. This also means that MCP is not responsible for management of users. In practical terms, federation means that users asked to authenticate in MCP will be redirected to a login webpage supplied by their organization where they can login using their organizational id.</p>
</div>
<div class="paragraph">
<p>Since the authentication process is the responsibility of the organizations, it is also up to the individual organizations to choose an appropriate authentication method. While most will likely use classic username/password authentication, multi factor security, biometric security or other approaches could be used.</p>
</div>
<div class="sect2">
<h3 id="openid-connect"><a class="anchor" href="#openid-connect"></a><a class="link" href="#openid-connect">4.1. OpenID Connect</a></h3>
<div class="paragraph">
<p><a href="https://openid.net/connect">OpenID Connect</a> is the protocol chosen to be used for user federation in MCP, and it should be supported by Service Providers. It is an interoperable authentication protocol based on the <a href="https://oauth.net/2/">OAuth 2.0</a> family of specifications. It uses straightforward REST/JSON message flows with a design goal of "making simple things simple and complicated things possible". It’s uniquely easy for developers to integrate, compared to any preceding Identity protocols.</p>
</div>
<div class="paragraph">
<p>OpenID Connect lets developers authenticate their users across websites and apps without having to own and manage password files. For the app builder, it provides a secure verifiable, answer to the question: "What is the identity of the person currently using the browser or native app that is connected to me?"</p>
</div>
<div class="paragraph">
<p>OpenID Connect allows for clients of all types, including browser-based JavaScript and native mobile apps, to launch sign-in flows and receive verifiable assertions about the identity of signed-in users.</p>
</div>
<div class="paragraph">
<p>OpenID Connect provides authentication details in JWT tokens, that can be encrypted or digitally signed.</p>
</div>
</div>
<div class="sect2">
<h3 id="mcp-user-federation-setup"><a class="anchor" href="#mcp-user-federation-setup"></a><a class="link" href="#mcp-user-federation-setup">4.2. MCP User Federation Setup</a></h3>
<div class="paragraph">
<p>In most federated setups there is 1 step from the website (Service Provider) that need authentication and the Identity Provider, normally presented with a "Log in with X" link, where X could be Facebook, Google, etc. The setup used in MCP has 2 steps, where the first step is MCP Identity Broker which presents the user with a list of available Identity Providers, which is the second step. For a deeper understanding of how this is actually done please read the <a href="https://www.keycloak.org/docs/latest/server_admin/index.html#_identity_broker_overview">Identity Broker overview section from the Keycloak manual</a>. Keycloak is the software used for MCP Identity Broker.</p>
</div>
<div class="paragraph">
<p>MCP expects the following attributes in the OpenID Connect JWT Access Token:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferred_username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username of the user in the parent organization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">given_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firstname of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lastname of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Maritime Resource Name of the organization the user is a member of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">permissions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of permissions for this user assigned by the organization the user is a member of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mrn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Maritime Resource Name of the user.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These attributes will be directly mapped from attributes provided by the organizations Identity Provider, so the Identity Provider must also provide these attributes, except for the "org"-attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="openid-connect-authentication-flow"><a class="anchor" href="#openid-connect-authentication-flow"></a><a class="link" href="#openid-connect-authentication-flow">4.3. OpenID Connect Authentication Flow</a></h3>
<div class="paragraph">
<p>To illustrate the authentication flows the sequence diagrams below is provided.</p>
</div>
<div class="paragraph">
<p>The first diagram below shows the standard <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">OpenID Connect Authorization Code Flow</a> involving a browser being used by the user to access a service in the form of a webpage.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-7771d5fae114e4678696a5a0e8179885.png" alt="diag 7771d5fae114e4678696a5a0e8179885" width="1052" height="785">
</div>
<div class="title">Authentication flow</div>
</div>
<div class="paragraph">
<p>The second diagram shows the flow used when an authenticated user is accessing a backend service. For browser based services this scenario is often used when the browser retrieves data from backend services. In this scenario since the user is authenticated, the user has a token that is presented for authentication for the backend service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-369fe2d4f035faa8a4cbca6f857a92a3.png" alt="diag 369fe2d4f035faa8a4cbca6f857a92a3" width="630" height="286">
</div>
<div class="title">Backend service authentication flow</div>
</div>
</div>
<div class="sect2">
<h3 id="keycloack"><a class="anchor" href="#keycloack"></a><a class="link" href="#keycloack">4.4. Keycloack</a></h3>
<div class="paragraph">
<p>Keycloak is one of many products that includes support for OpenID Connect, and it is the product that currently provides MCP Identity Broker which is the cornerstone in MCP user federation.</p>
</div>
<div class="paragraph">
<p>Keycloak is an open source product developed by RedHat. Keycloak can be set up to work in different ways. It can be set up as an Identity Broker in which case it will link to other Identity Providers, which is what MCP Identity Broker does, or it can be set up to work as an Identity Provider, using either a database or LDAP/AD as a backend. Due the ability to connect to LDAP/AD, Keycloak can be used as quick and easy way to set up a Identity Provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-connected-to-mcp"><a class="anchor" href="#getting-connected-to-mcp"></a><a class="link" href="#getting-connected-to-mcp">4.5. Getting connected to MCP</a></h3>
<div class="paragraph">
<p>If your organizations wishes to connect to MCP as an Identity Provider, to enable your uses to authenticate in MCP, please contact Oliver Haagh at <a href="mailto:oliver@dmc.international">oliver@dmc.international</a> in order to set it up. Note that currently you need to expose interfaces that supports either OpenID Connect or SAML2.</p>
</div>
<div class="paragraph">
<p>Within the scope of the EfficienSea2 and STM validation projects, organizations can get users registered in special project Identity Providers, supplied by MCP. To join MCP please fill out the form at <a href="https://management.maritimecloud.net/#/apply">Apply</a>.</p>
</div>
<div class="sect3">
<h4 id="setup-oidc-idp"><a class="anchor" href="#setup-oidc-idp"></a><a class="link" href="#setup-oidc-idp">4.5.1. Setting up an OpenID Connect Identity Provider</a></h4>
<div class="paragraph">
<p>OpenID Connect is supported by the latest ADFS and <a href="http://keycloak.org">Keycloak</a> releases. MCP Identity Broker only supports the <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">OpenID Connect Authorization Code Flow</a> when connecting to Identity Providers. This limitation only applies when the Identity Broker connects to Identity Providers, not when Services/Clients connects to the Identity Broker.</p>
</div>
<div class="paragraph">
<p>As default MCP Identity Broker expect the following attributes to be provided by an OpenID Connect Identity Provider:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferred_username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username of the user in the parent organization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">given_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firstname of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lastname of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">permissions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of permissions for this user assigned by the organization the user is a member of.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If your Identity Provider has the values in different attributes, some mapping can be set up.</p>
</div>
<div class="paragraph">
<p>The Identity Broker will generate and attach the organizations MRN and the users MRN to the user.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-an-openid-connect-identity-provider-for-multiple-organizations"><a class="anchor" href="#setting-up-an-openid-connect-identity-provider-for-multiple-organizations"></a><a class="link" href="#setting-up-an-openid-connect-identity-provider-for-multiple-organizations">4.5.2. Setting up an OpenID Connect Identity Provider for multiple organizations</a></h4>
<div class="paragraph">
<p>MCP has some special Identity Providers that handles the authentication for multiple organizations. Current examples are "IALA" and "BIMCO ExtraNet". These Identity Providers are responsible for vetting the organizations they provide authentication for, so that it is confirmed that the organization is who they claim to be. New organizations can be added by these Identity Providers. Since MCP currently needs to know about organizations centrally to be able to (among other things) issue certificates, some extra information is needed from these Identity Providers, to be able to create them in the central Identity Registry, if they are not already known.</p>
</div>
<div class="paragraph">
<p>The extra information must be given as attributes, in addition to the attributes mentioned in <a href="#setup-oidc-idp">Setting up an OpenID Connect Identity Provider</a>:</p>
</div>
<div class="paragraph">
<p>As default MCP Identity Broker expect the following attributes to be provided by an OpenID Connect Identity Provider:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mrn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Maritime Resource Name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Maritime Resource Name of the parent organization of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Human readable name of the parent organizations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org-address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address of the organization. It must be without linebreaks, ending with comma and the country of the address.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the MRN must be on the form "urn:mrn:mcl:user:dma@iala:thc" and "urn:mrn:mcl:org:dma@iala" for user and organization respectively. In this case the organization is "dma" whos identity is guaranteed by "iala".</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-an-saml2-identity-provider"><a class="anchor" href="#setting-up-an-saml2-identity-provider"></a><a class="link" href="#setting-up-an-saml2-identity-provider">4.5.3. Setting up an SAML2 Identity Provider</a></h4>
<div class="paragraph">
<p>SAML2 is supported by older ADFS releases.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NAMEID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username of the user in the parent organization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress" class="bare">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname" class="bare">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firstname of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname" class="bare">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lastname of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://schemas.microsoft.com/ws/2008/06/identity/claims/role" class="bare">http://schemas.microsoft.com/ws/2008/06/identity/claims/role</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of permissions for this user assigned by the organization the user is a member of.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If your Identity Provider has the values in different attributes, some mapping can be set up.</p>
</div>
<div class="paragraph">
<p>The Identity Broker will generate and attach the organizations MRN and the users MRN to the user.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pki-and-x-509-certificates"><a class="anchor" href="#pki-and-x-509-certificates"></a><a class="link" href="#pki-and-x-509-certificates">5. PKI and X.509 Certificates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <strong>Public Key Infrastructure (PKI)</strong> is a set of hardware, software, people, policies, and procedures needed to create, manage, distribute, use, store, and revoke digital authentication certificates and manage public-key encryption. Thereby helping an organization establish and maintain a trustworthy networking environment. There is no inherent requirement for using a PKI based solution for enabling secure machine to machine (M2M) communication, but it is the most commonly used solution and lots of software, standards and best practices exists for utilizing it. The choice of using PKI based on the X.509 standard for M2M communication in MCP was thus straightforward.</p>
</div>
<div class="paragraph">
<p>The key piece in a PKI architecture is a PKI CA (Certificate Authority) which is an entity that issues digital authentication certificates. A digital certificate that certifies the ownership of a public key by the named subject of the certificate. An obvious example would be creating a certificate for a vessel, which can serve to certify that a given document was indeed signed by someone in possession of the certificate issued to that vessel.</p>
</div>
<div class="paragraph">
<p>One of the most important aspects of designing a PKI based architecture is the certificate hierarchy planning because the design will affect how certificates are validated and used by PKI-enabled actors. Normally a PKI based architecture is arranged in a tree like hierarchy with a single root entity in the top and with numerous leaves called sub CAs. Each sub CA can have their own sub CA thereby forming a tree with a single entity at the top. Each leave in the tree is responsible for creating certificates, for example, ships or organizations. The reason for doing this is to be able to delegate the responsibility to different parties. For example, in the case of MCP one could envision that at some point in the future every flag state would be their own sub CA. Having the sole responsibility of issuing certificates for vessels registered under their own flag.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ca.png" alt="ca">
</div>
<div class="title">PKI hierarchy</div>
</div>
<div class="paragraph">
<p>In the current version of MCP we are working with four sub CAs that have the responsibility for issuing all certificates. The four sub CAs are IALA, BIMCO, SMART Navigation Project and the MCP Identity Registry itself.</p>
</div>
<div class="paragraph">
<p>The most important functionality of a CA is issuing digital certificates. A digital certificate certifies the ownership of a public key by the named subject of the certificate. This allows others (relying parties) to rely upon signatures or on assertions made about the private key that corresponds to the certified public key. In this model of trust relationships, a CA is a trusted third party—trusted both by the subject (owner) of the certificate and by the party relying upon the certificate. In the case of MCP these certificates are typically used to make secure connections between maritime actors over the Internet. A certificate is required in order to avoid the case that a malicious party which happens to be on the path to the target server pretends to be the actual target. Such a scenario is commonly referred to as a man-in-the-middle attack. The client uses the CA certificate to verify the CA signature on the server certificate, as part of the checks before establishing a secure connection. Likewise, the server has the option of inspecting the clients certificate before allowing it to connect.</p>
</div>
<div class="paragraph">
<p>To issue a new certificate for, for example, a vessel an administrator for the organization who owns the ship will need to log in to MCP Portal and use its functionality for issuing new certificates. The certificate being issued will contain information about the name of the ship, the owner, the flag state and other attributes such as MMSI and IMO number. In the current implementation there is no validation of this information other than that the organization must have been accepted when signing up. We do not expect this to be a problem for the foreseeable future as the number of participating parties is still relatively small. In the future where many more organizations have been added it might, for example, be possible to integrate with national registries so an automated checks of these information can be made.</p>
</div>
<div class="paragraph">
<p>After having issued a certificate the administrator can now install it on the ship in some way. The actual logistics about how and where to install it is outside of the scope of the identity registry as this might vary a lot between organizations and projects. This also reduces the functionality of the identity registry to just provide the core functionality of Identity management allowing users to be able to build innovative solutions on top of it. This also applies directly to machine to machine communication. The identity registry places no restrictions about what kind of machine to machine communication protocols that should be used, it just provides the basic infrastructure to allow for each machine to authenticate the host in the other end. Letting each project select their protocols if needed.</p>
</div>
<div class="sect2">
<h3 id="get-mcp-root-certificate"><a class="anchor" href="#get-mcp-root-certificate"></a><a class="link" href="#get-mcp-root-certificate">5.1. Get MCP Root Certificate</a></h3>
<div class="paragraph">
<p>In order to use the certificates issued by the MCP Identity Registry it is needed to add MCP Root Certificates to the relevant trustchain. Here you can download the root certificates for MCP instances:</p>
</div>
<div class="paragraph">
<p>MCP <strong>Production</strong> environment root certificates as <a href="http://developers.maritimeconnectivity.net/identity/prod-certificate/mc-ca-chain.pem">PEM (one file, primarily for Apache/Nginx)</a>, in <a href="http://developers.maritimeconnectivity.net/identity/prod-certificate/mc-truststore-password-is-changeit.jks">JKS (for Java)</a> or <a href="http://developers.maritimeconnectivity.net/identity/prod-certificate/mc-ca-certs.zip">a zip with the separate files (for windows)</a>.</p>
</div>
<div class="paragraph">
<p>MCP <strong>Staging</strong> environment root certificates as <a href="http://developers.maritimeconnectivity.net/identity/staging-certificate/mc-ca-chain.pem">PEM (one file, primarily for Apache/Nginx)</a>, in <a href="http://developers.maritimeconnectivity.net/identity/staging-certificate/mc-truststore-password-is-changeit.jks">JKS (for Java)</a> or <a href="http://developers.maritimeconnectivity.net/identity/staging-certificate/mc-ca-certs.zip">a zip with the separate files (for windows)</a>.</p>
</div>
<div class="paragraph">
<p>MCP <strong>Test</strong> environment root certificates as <a href="http://developers.maritimeconnectivity.net/identity/test-certificate/mc-ca-chain.pem">PEM (one file, primarily for Apache/Nginx)</a>, in <a href="http://developers.maritimeconnectivity.net/identity/test-certificate/mc-truststore-password-is-changeit.jks">JKS (for Java)</a> or <a href="http://developers.maritimeconnectivity.net/identity/test-certificate/mc-ca-certs.zip">a zip with the separate files (for windows)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="certificate-attributes"><a class="anchor" href="#certificate-attributes"></a><a class="link" href="#certificate-attributes">5.2. Certificate Attributes</a></h3>
<div class="paragraph">
<p>MCP can issue X.509 certificates for the users which can then be used for authentication. Service providers relying on X.509 certificate authentication must obtain and install MCP root certificate into their webservice.</p>
</div>
<div class="paragraph">
<p>The standard information present in an X.509 certificate includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Version</strong> – which X.509 version applies to the certificate (which indicates what data the certificate must include)</p>
</li>
<li>
<p><strong>Serial number</strong> – A unique assigned serial number that distinguishes it from other certificates</p>
</li>
<li>
<p><strong>Algorithm information</strong> – the algorithm used to sign the certificate</p>
</li>
<li>
<p><strong>Issuer distinguished name</strong> – the name of the entity issuing the certificate (MCP)</p>
</li>
<li>
<p><strong>Validity period of the certificate</strong> – start/end date and time</p>
</li>
<li>
<p><strong>Subject distinguished name</strong> – the name of the identity the certificate is issued to</p>
</li>
<li>
<p><strong>Subject public key information</strong> – the public key associated with the identity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Subject distinguished name field will consists of the following items:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">User</th>
<th class="tableblock halign-left valign-top">Vessel</th>
<th class="tableblock halign-left valign-top">Device</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">MMS</th>
<th class="tableblock halign-left valign-top">Organization</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CN (CommonName)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessel name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Domain Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization Name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">O (Organization)</p></td>
<td class="tableblock halign-center valign-bottom" colspan="6"><p class="tableblock">Organization MRN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OU (Organizational Unit)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"user"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"vessel"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"device"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"service"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"mms"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"organization"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E (Email)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User email</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C (Country)</p></td>
<td class="tableblock halign-center valign-bottom" colspan="6"><p class="tableblock">Organization country code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UID</p></td>
<td class="tableblock halign-center valign-bottom" colspan="5"><p class="tableblock">Entity MRN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization MRN</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An example of the fields for a vessel could look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C=DK, O=urn:mrn:mcl:org:dma, OU=vessel, CN=JENS SØRENSEN, UID=urn:mrn:mcl:vessel:dma:jens-soerensen</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, In additions to the information stored in the standard X.509 attributes listed above, the X509v3 extension SubjectAlternativeName (SAN) extension is used to store extra information. There already exists some predefined fields for the SAN extension, but they do not match the need we have for maritime related fields. Therefore the “otherName” field is used, which allows for using a Object Identifier (OID) to define custom fields. The OIDs currently used are not registered at ITU, but are randomly generated using a tool provided by ITU (see <a href="http://www.itu.int/en/ITU-T/asn1/Pages/UUID/uuids.aspx" class="bare">http://www.itu.int/en/ITU-T/asn1/Pages/UUID/uuids.aspx</a>). See the table below for the fields defined, the OIDs of the fields and which kind of entities that uses the fields.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Used by</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flagstate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.323100633285601570573910217875371967771</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Callsign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.208070283325144527098121348946972755227</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMO number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.291283622413876360871493815653100799259</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMSI number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.328433707816814908768060331477217690907</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AIS shiptype</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.107857171638679641902842130101018412315</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of register</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.285632790821948647314354670918887798603</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ship MRN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.268095117363717005222833833642941669792</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MRN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.271477598449775373676560215839310464283</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Users, Devices, Services, MMS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.174437629172304915481663724171734402331</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Users, Devices, Services, MMS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subsidiary MRN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.133833610339604538603087183843785923701</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Users, Devices, Services, MMS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Home MMS URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.171344478791913547554566856023141401757</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vessels, Users, Devices, Services, MMS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.25.245076023612240385163414144226581328607</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Encoding of string values in certificates must follow the specifications defined in RFC 5280, and where possible it is highly recommended to use UTF-8.</p>
</div>
</div>
<div class="sect2">
<h3 id="revocation-of-certificates"><a class="anchor" href="#revocation-of-certificates"></a><a class="link" href="#revocation-of-certificates">5.3. Revocation of certificates</a></h3>
<div class="paragraph">
<p>A crucial part of any PKI is to support revocation of certificates, so that certificates that belongs to entities who is no longer trusted, affiliation has change, etc., can be mark as not trusted any more. Anyone who wishes to validate a certificate can then check if the certificate has been marked as revoked. The checking of the certificate revocation status can be done in two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Call the OCSP interface provided by the Identity Registry for each certificate.</p>
</li>
<li>
<p>Periodically download a Certificate Revocation File from the Identity Registry and use it check certificates locally.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The endpoints for both the OCSP interface and the Certificate Revocation File are embedded into the certificates issued by MCP Identity Registry, and are currently <a href="https://api.maritimecloud.net/x509/api/certificates/crl" class="bare">https://api.maritimecloud.net/x509/api/certificates/crl</a> and <a href="https://api.maritimecloud.net/x509/api/certificates/ocsp" class="bare">https://api.maritimecloud.net/x509/api/certificates/ocsp</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="certificate-authentication-flow"><a class="anchor" href="#certificate-authentication-flow"></a><a class="link" href="#certificate-authentication-flow">5.4. Certificate Authentication Flow</a></h3>
<div class="paragraph">
<p>To illustrate the authentication flow the sequence diagram below is provided.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-7cd353fc09c685a22f21e7f38510ff9e.png" alt="diag 7cd353fc09c685a22f21e7f38510ff9e" width="748" height="298">
</div>
</div>
</div>
<div class="sect2">
<h3 id="obtaining-a-openid-connect-token-using-a-certificate"><a class="anchor" href="#obtaining-a-openid-connect-token-using-a-certificate"></a><a class="link" href="#obtaining-a-openid-connect-token-using-a-certificate">5.5. Obtaining a OpenId Connect Token using a Certificate</a></h3>
<div class="paragraph">
<p>It is possible to obtain OpenID Connect Tokens using certificate authentication. The idea is that instead of authenticating by being redirected to an Identity Provider as in the normal OpenID Connect flow, you authenticate at the Identity Broker by using your certificate (that has been issued by MCP Identity Registry). This authentication would work in the same way as when authenticating to any service. When authentication has been succesful the Identity Broker can then issue a JWT-token, which is what the OpenId Connect authentication use. So in effect what we have is a "bridge" between the 2 authentication approaches.</p>
</div>
<div class="paragraph">
<p>An example of use could be that a device (which has been issued certificates) wishes to authenticate securely with a service, but the service only supports OpenId Connect authentication. Using the approach mentioned above, the device can use its certificate to get an OpenId Connect token, which can then be used to authenticate to the service.</p>
</div>
<div class="paragraph">
<p>The flow looks like the diagram below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-9f6c8a8663a2d802fffbd4da7293afd6.png" alt="diag 9f6c8a8663a2d802fffbd4da7293afd6" width="901" height="551">
</div>
</div>
<div class="sect3">
<h4 id="example-of-obtaining-a-openid-connect-token-using-a-certificate"><a class="anchor" href="#example-of-obtaining-a-openid-connect-token-using-a-certificate"></a><a class="link" href="#example-of-obtaining-a-openid-connect-token-using-a-certificate">5.5.1. Example of Obtaining a OpenId Connect Token using a Certificate</a></h4>
<div class="paragraph">
<p>In this simple example we will assume that a certificate and key&#8212;&#8203;pair has been issued to the entity who wishes to authenticate. This example makes use of <code>curl</code> a commandline tool available on Linux and Mac OS X.</p>
</div>
<div class="paragraph">
<p>The authentication involves 2 steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtaining a temporary Authorization Code using a certificate.</p>
</li>
<li>
<p>Obtaining a OpenId Connect Token using the Authorization Code.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These 2 steps are actually standard in the <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">OpenID Connect Authorization Code Flow</a>, though normally certificates are not the standard authentication method.</p>
</div>
<div class="paragraph">
<p>First we obtain the code by issuing this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl --verbose --location --cookie "" --key PrivateKey.pem --cert Certificate.pem 'https://maritimeid.maritimecloud.net/auth/realms/MaritimeCloud/protocol/openid-connect/auth?client_id=cert2oidc&amp;redirect_uri=http%3A%2F%2Flocalhost%3A99&amp;response_type=code&amp;kc_idp_hint=certificates&amp;scope=openid'</pre>
</div>
</div>
<div class="paragraph">
<p>Let us break down the command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>curl --verbose --location --cookie ""</code>: <code>curl</code> is the tool itself. <code>--verbose</code> means it will be in verbose mode, <code>--location</code> means curl will follow HTTP redirects and <code>--cookie ""</code> activates the use of HTTP cookies which means that cookies received will be remember and used during redirects. We need to follow redirects since that is used by OpenID Connect to go back and forth between servers, and the verbose mode is needed because we would like to see where we are redirected&#8201;&#8212;&#8201;especially the last redirect, but more about that later.</p>
</li>
<li>
<p><code>--key PrivateKey.pem --cert Certificate.pem</code>: Here the private key and the certificate is given to <code>curl</code> in PEM format.</p>
</li>
<li>
<p>The last part is the URL which itself is multiple parts:</p>
<div class="ulist">
<ul>
<li>
<p>Address of the authentication endpoint: <code>https://maritimeid.maritimecloud.net/auth/realms/MaritimeCloud/protocol/openid-connect/auth</code></p>
</li>
<li>
<p>Parameters: <code>client_id=cert2oidc&amp;redirect_uri=http%3A%2F%2Flocalhost&amp;response_type=code&amp;kc_idp_hint=certificates&amp;scope=openid</code>. These can be also be broken down:</p>
<div class="ulist">
<ul>
<li>
<p><code>client_id=cert2oidc</code>: This is a special OpenID Connect client setup to be used for certificate authentication.</p>
</li>
<li>
<p><code>redirect_uri=http%3A%2F%2Flocalhost%3A99</code>: This is where the authentication server will redirect to at the end of the authentication. The parameter is URL encoded and decoded looks like this: <code>http://localhost:99</code>. This address is meant to be invalid, since we want the last redirect to fail.</p>
</li>
<li>
<p><code>response_type=code</code>: This defines that we uses the Authorization Flow as mentioned above.</p>
</li>
<li>
<p><code>kc_idp_hint=certificates</code>: This tells the Identity Broker that we wants to authenticate using the Certificate Identity Provider.</p>
</li>
<li>
<p><code>scope=openid</code>: And finally, this define that we are using OpenID Connect.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the command runs it returns a lot of output, due to being in verbose mode. We will not go into detail, but quite a few redirects happens, as described in the sequences diagram above. The last redirect however fails, which is intended. The final output will look something like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>* Issue another request to this URL: 'http://localhost:99?code=uss.Yw6k4rXOJiR6IF4a2Y7tYC1-Eqoo8dHSUwjfuIFDfpI.543a63db-9d22-45f7-85b6-a258059c0825.6826c662-6b68-423a-a248-71bd3e69dab0'
* Rebuilt URL to: http://localhost:99/?code=uss.Yw6k4rXOJiR6IF4a2Y7tYC1-Eqoo8dHSUwjfuIFDfpI.543a63db-9d22-45f7-85b6-a258059c0825.6826c662-6b68-423a-a248-71bd3e69dab0
*   Trying 127.0.0.1...
* connect to 127.0.0.1 port 99 failed: Connection refused
* Failed to connect to localhost port 99: Connection refused
* Closing connection 1
curl: (7) Failed to connect to localhost port 99: Connection refused</pre>
</div>
</div>
<div class="paragraph">
<p>Here we can recognize <code>http://localhost:99</code> from the <code>redirect_uri</code> parameter described earlier. We can also see that a <code>code</code> parameter is in the url, in this case with the value <code>uss.Yw6k4rXOJiR6IF4a2Y7tYC1-Eqoo8dHSUwjfuIFDfpI.543a63db-9d22-45f7-85b6-a258059c0825.6826c662-6b68-423a-a248-71bd3e69dab0</code>. It is this code we need to in the second step of authentication to get the OpenID Connect Tokens. The code is only valid for a very limited time (less than a minute) and can only be used once. We will again use <code>curl</code> in the second step:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl --data "grant_type=authorization_code&amp;client_id=cert2oidc&amp;code=uss.Yw6k4rXOJiR6IF4a2Y7tYC1-Eqoo8dHSUwjfuIFDfpI.543a63db-9d22-45f7-85b6-a258059c0825.6826c662-6b68-423a-a248-71bd3e69dab0&amp;redirect_uri=http%3A%2F%2Flocalhost%3A99" https://maritimeid.maritimecloud.net/auth/realms/MaritimeCloud/protocol/openid-connect/token</pre>
</div>
</div>
<div class="paragraph">
<p>Again, let us break down the command. In this case the command consist of 3 parts, <code>curl</code>&#8201;&#8212;&#8201;the tool itself, data-parameters and an URL. We will concentrated on the data-parameters. Note that this is a HTTP POST request, which is why the parameters is supplied in a separate argument and not as part of the URL.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grant_type=authorization_code</code>: This specifies that we will use an authorization code to authenticate ourself in this call.</p>
</li>
<li>
<p><code>client_id=cert2oidc</code>: The id of the special client, as mentioned above.</p>
</li>
<li>
<p><code>code=uss.Yw6k4rXOJiR6IF4a2Y7tYC1-Eqoo8dHSUwjfuIFDfpI.543a63db-9d22-45f7-85b6-a258059c0825.6826c662-6b68-423a-a248-71bd3e69dab0</code>: The code we obtained earlier.</p>
</li>
<li>
<p><code>redirect_uri=http%3A%2F%2Flocalhost%3A99</code>: The redirect url, the same as before, though not used for actual redirection in this case.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When this call runs there will be no redirection, so we do not need to tell <code>curl</code> to follow redirects. Instead the returned output will be the tokens that we wish to use, in a format like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
   "access_token":"eyJhbGciOiJ...uXoHudIM1yiDBYj8g",
   "expires_in":300,
   "refresh_expires_in":1800,
   "refresh_token":"eyJhbGciOiJ...iv7rKSa__IKy983Gg",
   "token_type":"bearer",
   "id_token":"eyJhbGciOiJ...Ycp2GupfpTTgRkhtnw",
   "not-before-policy":0,
   "session_state":"94487eaa-b77f-4b6c-8db1-c574fc6a09da"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>access_token</code> is the token that should be used we communicating with services in MCP context. The token should be embedded in the HTTP header. When using <code>curl</code> it can be done like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H "Authorization: Bearer eyJhbGciOiJ...uXoHudIM1yiDBYj8g" https://api.maritimecloud.net/oidc/api/org/DMA</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>refresh_token</code> is used to re-authenticate to get a new set of tokens when the access_token has expired, in this case 300 seconds after it has been issued, as seen in the <code>expires_in</code> attribute. The new set of tokens can then be obtain with a HTTP POST like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl --data "grant_type=refresh_token&amp;client_id=cert2oidc&amp;refresh_token=eyJhbGciOiJ...iv7rKSa__IKy983Gg" https://maritimeid.maritimecloud.net/auth/realms/MaritimeCloud/protocol/openid-connect/token</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authorization"><a class="anchor" href="#authorization"></a><a class="link" href="#authorization">6. Authorization</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another central aspect of Identity Management is the concept of authorization which is the process of determining a set of permissions that is granted to a specific trusted identity. In all practical senses, authorization follows authentication. Once a system knows who you are, the system can determine what is appropriate for you to be able to see or do. authorization can be determined based on the user identity alone, but in most cases requires additional attributes about the user, such as role, title, flag state, etc.</p>
</div>
<div class="paragraph">
<p>Authorization can typically be handled in two ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Locally by the application or service that is being accessed.</p>
</li>
<li>
<p>Centralizing the authorization policy decisions regardless of the location of the user or the application/service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since authorization can always be done locally by the application that is being accessed, for example by storing user rights in a local database, we have decided that MCP will not prioritize central support for authorization for the next milestones. Instead focusing on getting authentication right.</p>
</div>
<div class="paragraph">
<p>Before implementation of centralized support for authorization can begin there are some obstacles that lie ahead. Mainly because there, unlike authentication, are no good standards for doing authorization.</p>
</div>
<div class="paragraph">
<p>Even though there are no real standards there are a number of approaches that are commonly used. The most commonly used probably being role-based access control (RBAC). RBAC is an access control mechanism defined around roles and privileges. The components of RBAC such as role-permissions, user-role and role-role relationships make it simple to do user assignments of entitlements. However, adopting RBAC for MCP opens some questions. For example, who defines the roles and are they global roles. Or are they local to a particular service or a particular organization. For example, an "administrator" role might entail a list of certain privileges in one organization and another list of privileges in another organization.</p>
</div>
<div class="paragraph">
<p>Given these issues and many other we have to decide not to implement central authorization in MCP. Instead MCP will provide the information that can be used for authorization in the services.</p>
</div>
<div class="paragraph">
<p>As described in the sections about <a href="#OpenID Connect">[OpenID Connect]</a> and <a href="#Certificate Attributes">[Certificate Attributes]</a>, both authentication methods provides information about the authenticated user that can be used for authorization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The organization the entity belong to.</p>
</li>
<li>
<p>The permissions/roles/groups the entity has been assigned by the organization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an organization wishes to use a service, the organization will then make an agreement with that about how access levels shall be defined in that service, based on the permissions. This will have to be done for each service the organization wishes to use.</p>
</div>
<div class="sect2">
<h3 id="example-of-authorization"><a class="anchor" href="#example-of-authorization"></a><a class="link" href="#example-of-authorization">6.1. Example of Authorization</a></h3>
<div class="paragraph">
<p>As an example of how authorization can be done, let us have a look at how it is handled inside the MCP Identity Registry. When it comes to authorization, the Identity Registry will have the same information about its users as any other service in MCP.</p>
</div>
<div class="paragraph">
<p>The Identity Registry currently has these roles:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Identity Registry Roles</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-center valign-top">Approve New Org</th>
<th class="tableblock halign-center valign-top">Edit Own Org</th>
<th class="tableblock halign-center valign-top">Maintain Org Users</th>
<th class="tableblock halign-center valign-top">Maintain Org Vessels</th>
<th class="tableblock halign-center valign-top">Maintain Org Services</th>
<th class="tableblock halign-center valign-top">Maintain Org Devices</th>
<th class="tableblock halign-center valign-top">Maintain Org MMS</th>
<th class="tableblock halign-center valign-top">Maintain Org Roles</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Delete Org</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_SITE_ADMIN</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">X</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_ORG_ADMIN</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">X</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_ENTITY_ADMIN</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">X</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_USER_ADMIN</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_VESSEL_ADMIN</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">X</p></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_SERVICE_ADMIN</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_DEVICE_ADMIN</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_MMS_ADMIN</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"></th>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">ROLE_APPROVE_ORG</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">ROLE_USER</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A few things should be noted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Maintain" (as mentioned in the table above) means to be able to create, update and delete, as well as issuing and revoking certificates.</p>
</li>
<li>
<p>Excluding entities with the role ROLE_SITE_ADMIN, it is not possible for entities to see entities from other organizations.</p>
</li>
<li>
<p>A ROLE_SITE_ADMIN can maintain entities and organizations beyond his own organization.</p>
</li>
<li>
<p>Any entity, regardless of roles, can see all entities from its own organization, though some sensitive information from services is filtered for non-admins.</p>
</li>
<li>
<p>Only a ROLE_SITE_ADMIN can assign ROLE_SITE_ADMIN and ROLE_APPROVE_ORG roles.</p>
</li>
<li>
<p>A ROLE_APPROVE_ORG can create a user for an organization if and only if there is no users for the organization (this is used for creating the first administrative user for an organization).</p>
</li>
<li>
<p>A ROLE_MMS_ADMIN can maintain MMS owned and operated by his own organization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example we will focus on <strong>ROLE_USER</strong> and <strong>ROLE_ORG_ADMIN</strong>. Let us assume that an Organization (DMA) wants to grant members of the internal "E-navigation" department administrative rights in the MCP Identity Registry. In DMAs Identity Provider setup the department name is automatically added to the "permissions" attribute. So to make this mapping the current DMA administrator sets up a role mapping between the permission "E-navigation" and the role ROLE_ORG_ADMIN. Once this is done, all members of the DMA E-navigation department will have administrative rights for the DMA organization inside the Identity Registry. As noted earlier, these rights only apply inside the Identity Registry. Other services must create a similar setup with mapping of roles and permissions.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="terminology"><a class="anchor" href="#terminology"></a><a class="link" href="#terminology">7. Terminology</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the terminology in this section has been taken from ISO/IEC 24760-1:2011 - A framework for identity management - Terminology and concepts</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication:</strong> The process of verifying the identity claimed by an entity based on its credentials.</p>
</li>
<li>
<p><strong>Authorization:</strong> The process of establishing a specific entitlement that is consistent with authorization policies.</p>
</li>
<li>
<p><strong>Authorization policies:</strong> Declarations that define entitlements of a security principal and any constraints related to that entitlement.</p>
</li>
<li>
<p><strong>Entitlements:</strong> The actions an entity in a network is allowed to perform and the resources to which it is allowed access.</p>
</li>
<li>
<p><strong>Federated identity:</strong> Is the means of linking a person&#8217;s electronic identity and attributes, stored across multiple distinct identity management systems</p>
</li>
<li>
<p><strong>Identity:</strong> The set of attributes that uniquely identifies a security principal. A security principal can have many different accounts that it uses to access various applications in the network. These accounts can be identified by these applications using different attributes of this entity. For example, a user can be known in the e-mail service by an e-mail ID, whereas that same user can be known in the human resource application by an employee number. The global set of such attributes constitutes the identity of the entity.</p>
</li>
<li>
<p><strong>Identity administration:</strong> The act of managing information associated with the identity of a security principal. The information can be used by the identity management infrastructure itself to determine administrative privileges.</p>
</li>
<li>
<p><strong>Identity management policies:</strong> Policies affecting the management of identities which includes naming policies and security policies.</p>
</li>
<li>
<p><strong>Realm:</strong> A collection of identities and associated policies which is typically used when enterprises want to isolate user populations and enforce different identity management policies for each population.</p>
</li>
<li>
<p><strong>Security principals:</strong> The subjects of authorization policies, such as users, user groups, and roles. A security principal can be a human or any application entity with an identity in the network and credentials to assert the identity.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a><a class="link" href="#appendix">8. Appendix</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>The use of MCP as a login mechanism:</strong> We share our experience from <a href="http://stmvalidation.eu/news/portcdm-information-sharing-in-real-time/">PortCDM</a> on how to utilize MCP as a login mechanism based on Keycloak; refer <a href="https://github.com/MaritimeConnectivityPlatform/developers.maritimeconnectivity.net/raw/gh-pages/identity/docx/The%20use%20of%20MCP%20as%20login-mechanism.docx">this Microsoft Word file</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Geocasting refers to the delivery of information to a group of actors identified by their geographical locations.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-10-28 15:40:38 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>